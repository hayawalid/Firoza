<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Product</title>
    <link rel="stylesheet" href="/CSS/Add-product.css">
    <script src="/Javascript/editProduct.js"></script>
    <link rel="stylesheet" href="/CSS/Admin-NavBar.css">
    <script src="/Javascript/nav-bar.js"></script>
    <script src="/Javascript/adminNavbar.js"></script>
</head>
<body>
    <% include('./partials/Admin-NavBar.ejs') %>
    <div class="container" id="container">
        <form action="/admin/EditProduct/<%= product._id %>" method="POST">
            <h1>Edit product</h1>
            <input type="text" name="product_id" placeholder="Product ID" value="<%= product._id %>" required disabled>
            <input type="text" name="name" placeholder="Product Name" value="<%= product.name %>" required>
            <input type="number" name="price" placeholder="Price" min="1000" value="<%= product.price %>" required>
            <select name="collection_id" id="Collections" required>
                <option value="" disabled selected>Belongs to</option>
                <option value="1" <%= product.collection_id === "1" ? "selected" : "" %>>None</option>
                <option value="1" <%= product.collection_id === "1" ? "selected" : "" %>>Indian</option>
                <option value="2" <%= product.collection_id === "2" ? "selected" : "" %>>Egyptian</option>
            </select>
            <select name="category" id="Category" required>
                <option value="" disabled selected>Category</option>
                <option value="Ring" <%= product.category === "Ring" ? "selected" : "" %>>Ring</option>
                <option value="Necklace" <%= product.category === "Necklace" ? "selected" : "" %>>Necklace</option>
                <option value="Earrings" <%= product.category === "Earrings" ? "selected" : "" %>>Earrings</option>
                <option value="Bracelet" <%= product.category === "Bracelet" ? "selected" : "" %>>Bracelet</option>
            </select>
            <div class="uploadOuter">
                <label for="uploadFile" class="btn btn-primary">Upload Image</label>
                <strong>OR</strong>
                <span class="dragBox">
                    Drag and Drop image here
                    <input type="file" name="img" id="uploadFile" accept="image/*" onchange="previewImage(event)" />
                </span>
                <!-- Image preview -->
                <div id="imagePreview" class="image-preview"></div>
            </div>
            <h4 class="successful"></h4>
            <h6 class="s"></h6>
            <span class="sure"></span>
            <input type="text" name="description" placeholder="Product Description" value="<%= product.description %>" required>
            <div id="sizes-container">
                <% product.sizes.forEach(size => { %>
                    <div class="size-quantity-pair">
                        <select name="sizes[]" class="size-select" required>
                            <option value="" disabled <%= !size.size ? "selected" : "" %>>Size</option>
                            <option value="0" <%= size.size === "0" ? "selected" : "" %>>Standard</option>
                            <option value="1" <%= size.size === "1" ? "selected" : "" %>>Adjustable</option>
                            <option value="9" <%= size.size === "9" ? "selected" : "" %>>9</option>
                            <option value="10" <%= size.size === "10" ? "selected" : "" %>>10</option>
                            <option value="11" <%= size.size === "11" ? "selected" : "" %>>11</option>
                            <option value="12" <%= size.size === "12" ? "selected" : "" %>>12</option>
                        </select>
                        <input type="number" name="quantities[]" placeholder="Quantity" min="1" value="<%= size.quantity %>" required>
                    </div>
                <% }) %>
            </div>
            <button type="button" onclick="addSizeQuantityPair()" id="addB">Add Size</button>
            <select name="material" id="Material" required>
                <option value="" disabled selected>Material</option>
                <option value="Gold" <%= product.material === "Gold" ? "selected" : "" %>>Gold</option>
                <option value="Silver" <%= product.material === "Silver" ? "selected" : "" %>>Silver</option>
                <option value="Platinum" <%= product.material === "Platinum" ? "selected" : "" %>>Platinum</option>
                <option value="Titanium" <%= product.material === "Titanium" ? "selected" : "" %>>Titanium</option>
            </select>
            <select name="color" id="Color" required>
                <option value="" disabled selected>Color</option>
                <option value="Red" <%= product.color === "Red" ? "selected" : "" %>>Red</option>
                <option value="Blue" <%= product.color === "Blue" ? "selected" : "" %>>Blue</option>
                <option value="Green" <%= product.color === "Green" ? "selected" : "" %>>Green</option>
                <option value="Yellow" <%= product.color === "Yellow" ? "selected" : "" %>>Yellow</option>
                <option value="Black" <%= product.color === "Black" ? "selected" : "" %>>Black</option>
                <option value="White" <%= product.color === "White" ? "selected" : "" %>>White</option>
                <option value="Multi" <%= product.color === "Multi" ? "selected" : "" %>>Multicolor</option>
            </select>
            <button type="submit" id="submitButton">Save</button>
        </form>
    </div>
    <script>
        function previewImage(event) {
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function(event) {
                const imagePreview = document.getElementById('imagePreview');
                imagePreview.innerHTML = `<img src="${event.target.result}" alt="Preview Image" style="max-width: 100%; height: auto;">`;
            }

            reader.readAsDataURL(file);
        }

        document.addEventListener("DOMContentLoaded", function () {
            const submitButton = document.getElementById('submitButton');

            submitButton.addEventListener('click', function(event) {
                const inputField = document.querySelector('input[name="name"]');
                const numberField = document.querySelector('input[name="price"]');
                const categories = document.getElementById('Category');
                const collections = document.getElementById('Collections');

                const sureMessage = document.querySelector('.sure');

                if (inputField.value === "" || numberField.value === "" || categories.value === "" || collections.value === "") {
                    event.preventDefault(); // Prevent form submission
                    sureMessage.innerHTML = "Please fill all required fields.";
                }
            });
        });

        function addSizeQuantityPair() {
            const container = document.getElementById('sizes-container');
            const pairDiv = document.createElement('div');
            pairDiv.className = 'size-quantity-pair';
            pairDiv.innerHTML = `
                <select name="sizes[]" class="size-select" required>
                    <option value="" disabled selected>Size</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                </select>
                <input type="number" name="quantities[]" placeholder="Quantity" min="1" required>
            `;
            container.appendChild(pairDiv);

            // Update the count and check if button should be disabled
            updateAddButtonState();
        }

        let Count = 0;

        function updateAddButtonState() {
            Count++;
            if (Count === 3) {
                const addButton = document.getElementById('addB');
                addButton.disabled = true;
            }
        }

        // Add event listener to the button
        document.addEventListener('DOMContentLoaded', () => {
            const addButton = document.getElementById('addB');
            addButton.addEventListener('click', addSizeQuantityPair);
        });

    </script>
</body>
</html>
